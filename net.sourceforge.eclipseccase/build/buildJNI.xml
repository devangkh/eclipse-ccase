<project name="ccjni" default="all">

	<property name="projectdir" value="${basedir}/.."/>
	
	<property	file="${projectdir}/build.properties"/>

	<property	name="jdk.home" value="${java.home}/.."/>
	<property	name="java.build" value="${projectdir}/bin"/>

	<property	name="jni.build" value="${java.build}/jni"/>
	<property	name="dll.name" value="ccjni.dll"/>
	<property	name="output.dll" value="${jni.build}/${dll.name}"/>
	
	<target name="clean">
		<delete dir="${jni.build}" quiet="true"/>
		<delete file="${dll.name}" quiet="true"/>
		<echo message="Clean complete"/>		
	</target>

	<target name="all" depends="init,jni_dll">
		<echo message="Build complete"/>		
	</target>

	<target name="init">
		<available property="ccjni.dll.exists" file="${projectdir}/${dll.name}"/>
	</target>

	<target name="jni_init" depends="init" unless="ccjni.dll.exists">
		<mkdir dir="${jni.build}"/>
	</target>

	<target name="jni_headers" depends="jni_init" unless="ccjni.dll.exists">
		<echo message="Generating jni headers"/>
		<javah	destdir="${jni.build}"
				class="net.sourceforge.eclipseccase.ClearcaseJNI"
				classpath="${java.build}"
				verbose="true"/>
	</target>
	
	<target name="jni_dll" depends="jni_init,jni_headers" unless="ccjni.dll.exists">
		<echo message="Compiling jni dll"/>
		<cc objdir="${jni.build}" outfile="${output.dll}"
			 name="msvc" debug="${debug}" outtype="shared" runtime="static" exceptions="true">
			<includepath location="${jdk.home}/include"/>
			<includepath location="${jdk.home}/include/win32"/>
			<includepath location="${jni.build}"/>
			<fileset dir="${projectdir}/src" includes="*.cpp"/>
		</cc>
		<copy file="${output.dll}" todir="${projectdir}"/>
	</target>
	
	<taskdef name="cc" classname="net.sf.antcontrib.cpptasks.CCTask" classpath="${projectdir}/lib/cpptasks.jar"/>

</project>
